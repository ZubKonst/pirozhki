pirozhki_db_volume:
  image: ubuntu:14.04
  command: true
  volumes:
   - /var/lib/postgresql/data
   - /data

pirozhki_postgres:
  image: postgres:9.3
  environment:
    POSTGRES_USER: pirozhki
    POSTGRES_PASSWORD: mysecretpassword
  volumes_from:
    - pirozhki_db_volume

pirozhki_redis:
  image: redis:2.8
  command: redis-server --appendonly yes
  volumes_from:
    - pirozhki_db_volume

web:
  build: .
  command: puma -C config/sidekiq_web.rb
  ports:
    - 80:80
  links:
    - pirozhki_redis:redis

sidekiq:
  build: .
  command: sidekiq -r ./app.rb -C config/variables/sidekiq.yml -d -L log/sidekiq_worker.log
  links:
    - pirozhki_postgres:postgres
    - pirozhki_redis:redis
